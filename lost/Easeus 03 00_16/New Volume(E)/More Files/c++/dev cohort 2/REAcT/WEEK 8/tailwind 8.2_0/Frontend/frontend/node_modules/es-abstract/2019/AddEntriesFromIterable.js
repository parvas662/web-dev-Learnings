'use strict';

var hasOwn = require('hasown');

module.exports = function (toSorted, t) {
	var nums = [2, 1, 3];
	var result = toSorted(nums);
	t.deepEqual(
		result,
		[1, 2, 3],
		'array is sorted'
	);
	t.notEqual(nums, result, 'original array is not returned');
	t.deepEqual(nums, [2, 1, 3], 'original array is unchanged');

	nums.sort();
	t.deepEqual(nums, result, 'mutated original matches result');

	t.deepEqual(
		toSorted('acab'),
		['a', 'a', 'b', 'c'],
		'string sorts to array'
	);

	var halfPoo = '\uD83D';
	var endPoo = '\uDCA9';
	var poo = halfPoo + endPoo;
	t.deepEqual(
		toSorted('a' + poo + 'c'),
		['a', 'c', halfPoo, endPoo],
		'code point is sorted as expected'
	);

	var arrayLikeLengthValueOf = {
		length: {
			valueOf: function () { return 2; }
		},
		0: 4,
		1: 0,
		2: 1
	};
	t.deepEqual(toSorted(arrayLikeLengthValueOf), [0, 4]);

	t.test('not positive integer lengths', function (st) {
		st.deepEqual(toSorted({ length: -2 }), []);
		st.deepEqual(toSorted({ length: 'dog' }), []);
		st.deepEqual(toSorted({ length: NaN }), []);

		st.end();
	});

	t.test('getters', { skip: !Object.defineProperty }, function (st) {
		var getCalls = [];

		var arrayLike = {
			0: 2,
			1: 1,
			2: 3,
			length: 3
		};
		Object.defineProperty(arrayLike, '0', {
			get: function () {
				getCalls.push(0);
				return 2;
			}
		});
		Object.defineProperty(arrayLike, '1', {
			get: function () {
				getCalls.push(1);
				return 1;
			}